---
import slug from "slug";
import Layout from "../../../layouts/Layout.astro";
import type { FilmResponse } from "../../../pocketbase-types";

export const prerender = false;

const { idFilm } = Astro.params;

if (!idFilm) {
    return Astro.redirect("/films");
}

let message = "";
let film = {} as FilmResponse;

if (idFilm) {
    film = await Astro.locals.pb.collection("Film").getOne<FilmResponse>(idFilm);
}

if (Astro.request.method === "POST") {
    const filmSuppr = await Astro.locals.pb
        .collection("Film")
        .delete(idFilm!)
        .catch((error) => {
            console.error("Erreur lors de la suppression du film :", error);
            message = error.message;
        });
    if (filmSuppr) {
        return Astro.redirect("/films");
    }
}
---

<Layout titre="Supprimer un film">
    <h1 class="text-4xl mb-12 text-gray-900">Supprimer un film</h1>
    {message && <p class="text-red-600">{message}</p>}
    <form method="post">
        <input name="film" type="hidden" value={idFilm} />
        <input
            name="user"
            type="hidden"
            value={Astro.locals.pb.authStore.record?.id}
        />
        <label>
            <span class="text-gray-700">Titre du film :</span>
            {film.titre}
        </label>

        <button
            type="submit"
            class="items-center gap-2 mt-8 border-2 border-red-600 text-red-600 hover:bg-red-600 hover:text-white font-semibold px-6 py-3 rounded-lg transition-colors block!"
            >Supprimer</button
        >
    </form>
</Layout>