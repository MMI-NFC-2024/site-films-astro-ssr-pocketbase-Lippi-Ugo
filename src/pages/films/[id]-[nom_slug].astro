---
import Layout from "../../layouts/Layout.astro";
import ImgPb from "../../components/ImgPb.astro";
import type { FilmResponse, PersonneResponse } from "../../pocketbase-types";
import { Debug } from "astro:components";
export const prerender = false;
const { id } = Astro.params as { id: string; nom_slug: string };
const film = await Astro.locals.pb.collection("Film").getOne<
    FilmResponse<{
        realisateur: PersonneResponse;
        producteur: PersonneResponse[];
        scenariste: PersonneResponse[];
    }>
>(id, {
    expand: "realisateur, producteur, scenariste",
});
---

<Layout titre={film.titre}>
    <a
        href="/films"
        class="inline-flex items-center text-slate-600 hover:text-blue-600 mb-8 transition-colors font-medium"
    >
        ← Retour aux films
    </a>
    <div class="mb-6">
        <h1 class="text-4xl font-bold mb-2 text-slate-900">{film.titre}</h1>
        <p class="text-slate-600 text-sm">
            {film.genres ? film.genres.join(", ") + " · " : ""}
        </p>
    </div>
    <div class="flex flex-col md:flex-row md:gap-6 mb-10">
        <div class="w-full md:w-1/3 lg:w-1/4 mb-4 md:mb-0">
            <ImgPb
                record={film}
                field="affiche"
                classPicture="w-full h-full"
                classImg="w-full h-auto object-cover rounded-lg"
                thumb="400x600"
            />
        </div>
    </div>
    <div>
        <h2>Réalisateur</h2>
        <!-- <Debug {film} /> -->
        <p>{film.expand.realisateur.prenom} {film.expand.realisateur.nom}</p>

        {
            film.expand.producteur && (
                <h2>Producteur{film.expand.producteur.length > 1 && "s"}</h2>
            )
        }
        {
            film.expand.producteur?.map((prod) => (
                <p>
                    {prod.prenom} {prod.nom}
                </p>
            ))
        }
    </div>
    {
        Astro.locals.pb.authStore.record?.id === film.user && (
            <a
                href={`/films/edit/${film.id}`}
                class="inline-flex items-center gap-2 mt-8 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg shadow-lg hover:shadow-xl transition-all"
            >
                Modifier le film
            </a>
        )
    }
</Layout>
